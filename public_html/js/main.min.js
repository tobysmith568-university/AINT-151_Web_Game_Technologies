function OnLoad(){if("undefined"!=typeof Storage){var a=!0;if(void 0===localStorage.roomNumber&&(localStorage.roomNumber=JSON.stringify(6),a=!1),void 0===localStorage.knownRooms){var b=[2,3,4,5,6,9,10,11,12,13,14,15,16,17,18,19,21,22,24,25,26,27,28,30,31,32,33];localStorage.knownRooms=JSON.stringify(b),a=!1}if(void 0===localStorage.hiddenTasks){var b=[{room:9,index:1},{room:21,index:1}];localStorage.hiddenTasks=JSON.stringify(b),a=!1}if(void 0===localStorage.inventory){var b=[{snowflake:"info",wearing:"017"}];localStorage.inventory=JSON.stringify(b),a=!1}if(void 0===localStorage.items&&(localStorage.items=JSON.stringify(items),a=!1),void 0===localStorage.rooms&&(localStorage.rooms=JSON.stringify(rooms),a=!1),1==a){var c=document.getElementById("tmp_newGame").cloneNode(!0);c.id="",document.getElementById("messages").innerHTML="",document.getElementById("messages").appendChild(c)}}else window.location.replace("error.html");SelectRoom(JSON.parse(localStorage.roomNumber))}function SelectRoom(a,b){b&&(document.getElementById("messages").innerHTML='<div style="height:113px"/>');var c=JSON.parse(localStorage.rooms),d=JSON.parse(localStorage.knownRooms),f=(JSON.parse(localStorage.roomNumber),JSON.parse(localStorage.hiddenTasks)),g=c[a].wallText;document.getElementById("roomTitle").innerHTML=c[a].name;var h=c[a].description;""!=g&&(h+="\nOn the wall you have written:\n"+g),document.getElementById("roomText").innerHTML=h,document.getElementById("roomDoors").innerHTML="";for(var i=0;i<c[a].doors.length;i++){var j="btn btn-info door",k="";0!=c[a].doors[i].keys.length&&(j+=" disabled"),void 0!=c[c[a].doors[i].leadsTo]&&(k=d.indexOf(c[a].doors[i].leadsTo)==-1?"Unknown Room":c[c[a].doors[i].leadsTo].name),document.getElementById("roomDoors").innerHTML+='<a type="button" class="'+j+'" onClick="SelectRoom('+c[a].doors[i].leadsTo+', true)">'+k+"</a>"}document.getElementById("roomTasks").innerHTML="";for(var i=0;i<c[a].tasks.length;i++){var j="btn btn-info task",k="";c[a].tasks[i].keys.length>0&&(j+=" disabled");for(var l=0;l<f.length;l++)f[l].room==a&&f[l].index==i&&(j+=" hidden");k=c[a].tasks[i].name,document.getElementById("roomTasks").innerHTML+='<a type="button" class="'+j+'" onClick="RunTask('+i+')">'+k+"</a>"}document.getElementById("map").src="img/rooms/"+c[a].image,ArrayContains(d,a)||d.push(a),localStorage.roomNumber=JSON.stringify(a),localStorage.knownRooms=JSON.stringify(d),ShowInventory()}function NewGame(){localStorage.removeItem("roomNumber"),localStorage.removeItem("knownRooms"),localStorage.removeItem("rooms"),localStorage.removeItem("inventory"),localStorage.removeItem("items"),localStorage.removeItem("you"),localStorage.removeItem("hiddenTasks"),window.location.replace("game.html")}function ShowInventory(){var a=JSON.parse(localStorage.inventory),b=JSON.parse(localStorage.roomNumber);document.getElementById("inventory").innerHTML="";for(var c=1;c<a.length;c++){var d=document.getElementById("tmp_inventory").cloneNode(!0);d.id="",d.getElementsByClassName("inventoryName")[0].innerHTML=a[c].name,d.getElementsByClassName("inventoryName")[0].title=a[c].description,d.getElementsByClassName("inventoryName")[0].setAttribute("onclick",'AddMessage("'+a[c].name+':", "'+a[c].description+'")');for(var e=0;e<a[c].actions.length;e++)if(a[c].actions[e].roomIndex==-1||a[c].actions[e].roomIndex==b){var f=document.getElementById("tmp_action").cloneNode(!0);f.ID="",f.childNodes[0].href='javascript:RunAction("'+a[c].snowflake+'", '+a[c].actions[e].snowflake+");",f.childNodes[0].innerHTML=a[c].actions[e].name,d.getElementsByClassName("dropdown-menu")[0].appendChild(f)}if("026"==a[c].snowflake){for(var g=!1,e=0;e<a.length;e++)if("028"==a[e].snowflake){g=!0;break}if(!g)for(;d.getElementsByClassName("dropdown-menu")[0].firstChild;)d.getElementsByClassName("dropdown-menu")[0].removeChild(d.getElementsByClassName("dropdown-menu")[0].firstChild)}if("025"==a[c].snowflake){for(var g=!1,e=0;e<a.length;e++)if("028"==a[e].snowflake){g=!0;break}if(!g)for(;d.getElementsByClassName("dropdown-menu")[0].firstChild;)d.getElementsByClassName("dropdown-menu")[0].removeChild(d.getElementsByClassName("dropdown-menu")[0].firstChild)}if("027"==a[c].snowflake){for(var h=!1,e=0;e<a.length;e++)if("029"==a[e].snowflake){h=!0;break}if(!h)for(;d.getElementsByClassName("dropdown-menu")[0].firstChild;)d.getElementsByClassName("dropdown-menu")[0].removeChild(d.getElementsByClassName("dropdown-menu")[0].firstChild)}if(0==d.getElementsByClassName("dropdown-menu")[0].children.length){var f=document.getElementById("tmp_action").cloneNode(!0);f.ID="",f.childNodes[0].innerHTML="No actions",d.getElementsByClassName("dropdown-menu")[0].appendChild(f)}document.getElementById("inventory").appendChild(d)}}function AddMessage(a,b){document.getElementById("messages").innerHTML="";var c=document.getElementById("tmp_message").cloneNode(!0);c.id="theMessage",c.getElementsByClassName("panel-heading")[0].innerHTML=a+c.getElementsByClassName("panel-heading")[0].innerHTML,c.getElementsByClassName("panel-body")[0].innerHTML=b,document.getElementById("messages").appendChild(c)}function AddItem(a){for(var b=JSON.parse(localStorage.inventory),c=JSON.parse(localStorage.items),d=0;d<c.length;d++)c[d].snowflake==a&&b.push(c[d]);localStorage.inventory=JSON.stringify(b)}function RemoveItem(a){for(var b=JSON.parse(localStorage.inventory),c=0;c<b.length;c++)if(b[c].snowflake==a){b.splice(c,1);break}localStorage.inventory=JSON.stringify(b)}function DoorRemoveKey(a,b,c){for(var d=JSON.parse(localStorage.rooms),e=0;e<d[a].doors[b].keys.length;e++)d[a].doors[b].keys[e]==c&&d[a].doors[b].keys.splice(e,1);localStorage.rooms=JSON.stringify(d)}function RunTask(a){for(var b=JSON.parse(localStorage.rooms),c=JSON.parse(localStorage.roomNumber),d="",e=0;e<b[c].tasks[a].results.length;e++){var f=Math.floor(100*Math.random()+1);if(f<=b[c].tasks[a].results[e].chance&&(AddItem(b[c].tasks[a].results[e].item),d+="<br/>"+b[c].tasks[a].results[e].message,0==b[c].tasks[a].results[e].isRepeatable)){var g=b[c].tasks[a].results;g.splice(e,1),b[c].tasks[a].results=g}}d=""===d?"You find nothing.":d.substring(5),AddMessage(b[c].tasks[a].name+"...",d),localStorage.roomNumber=JSON.stringify(c),localStorage.rooms=JSON.stringify(b);var h=!1;switch(c){case 9:switch(a){case 0:AddTask(9,1),HideTask(9,0);break;case 1:c=33,h=!0}break;case 10:switch(a){case 0:case 1:case 2:case 3:case 4:HideTask(10,a)}break;case 31:window.location="profile.html"}SelectRoom(c,h)}function AddTask(a,b){for(var c=JSON.parse(localStorage.hiddenTasks),d=0;d<c.length;d++)c[d].room==a&&(c[d].index=b)&&c.splice(d,1);localStorage.hiddenTasks=JSON.stringify(c)}function HideTask(a,b){var c=JSON.parse(localStorage.hiddenTasks);c.push({room:a,index:b}),localStorage.hiddenTasks=JSON.stringify(c)}function TaskRemoveKey(a,b,c){for(var d=JSON.parse(localStorage.rooms),e=0;e<d[a].tasks[b].keys.length;e++)d[a].tasks[b].keys[e]==c&&d[a].tasks[b].keys.splice(e,1);localStorage.rooms=JSON.stringify(d)}function RunAction(a,b){switch(a){case"001":switch(b){case 0:var c=JSON.parse(localStorage.inventory);AddItem(c[0].wearing);var c=JSON.parse(localStorage.inventory);c[0].wearing="001",localStorage.inventory=JSON.stringify(c),RemoveItem("001")}break;case"002":switch(b){case 0:AddMessage("That was silly...","Nothing happened because of the power cut.")}break;case"003":switch(b){case 0:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(2,1,"003"),RemoveAction(0,"003"),RemoveAction(1,"005"),RemoveAction(2,"013"),RemoveAction(3,"016");break;case 1:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(3,1,"003"),RemoveAction(1,"003"),RemoveAction(2,"005"),RemoveAction(3,"013"),RemoveAction(4,"016");break;case 2:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(4,1,"003"),RemoveAction(2,"003"),RemoveAction(3,"005"),RemoveAction(4,"013"),RemoveAction(5,"016");break;case 3:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(5,1,"003"),RemoveAction(3,"003"),RemoveAction(4,"005"),RemoveAction(5,"013"),RemoveAction(6,"016");break;case 4:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(6,1,"003"),RemoveAction(4,"003"),RemoveAction(5,"005"),RemoveAction(6,"013"),RemoveAction(7,"016");break;case 5:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(13,1,"003"),RemoveAction(5,"003"),RemoveAction(6,"005"),RemoveAction(7,"013"),RemoveAction(8,"016");break;case 6:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(14,1,"003"),RemoveAction(6,"003"),RemoveAction(7,"005"),RemoveAction(8,"013"),RemoveAction(9,"016");break;case 7:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(15,1,"003"),RemoveAction(7,"003"),RemoveAction(8,"005"),RemoveAction(9,"013"),RemoveAction(10,"016");break;case 8:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(16,1,"003"),RemoveAction(8,"003"),RemoveAction(9,"005"),RemoveAction(10,"013"),RemoveAction(11,"016");break;case 9:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(17,1,"003"),RemoveAction(9,"003"),RemoveAction(10,"005"),RemoveAction(11,"013"),RemoveAction(12,"016");break;case 10:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(24,1,"003"),RemoveAction(10,"003"),RemoveAction(11,"005"),RemoveAction(12,"013"),RemoveAction(13,"016");break;case 11:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(25,1,"003"),RemoveAction(11,"003"),RemoveAction(12,"005"),RemoveAction(13,"013"),RemoveAction(14,"016");break;case 12:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(26,1,"003"),RemoveAction(12,"003"),RemoveAction(13,"005"),RemoveAction(14,"013"),RemoveAction(15,"016");break;case 13:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(27,1,"003"),RemoveAction(13,"003"),RemoveAction(14,"005"),RemoveAction(15,"013"),RemoveAction(16,"016");break;case 14:AddMessage("Success!","You unlock the draw."),TaskRemoveKey(278,1,"003"),RemoveAction(14,"003"),RemoveAction(15,"005"),RemoveAction(16,"013"),RemoveAction(17,"016");break;case 15:AddMessage("Failure!","That key does not unlock the door.");break;case 16:AddMessage("Failure!","That key does not unlock the filing cabinet.");break;case 17:AddMessage("Failure!","That key does not unlock the second locker.")}break;case"004":switch(b){case 0:var d=new Date;AddMessage("Check the time:","The current time is "+d.getHours()+":"+d.getMinutes()+".")}break;case"005":switch(b){case 0:AddMessage("Make the horn beep:","You can hear a faint car horn beep off in the distance...");break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:AddMessage("Failure!","That key does not unlock the draw.");break;case 16:AddMessage("Failure!","That key does not unlock the door.");break;case 17:AddMessage("Failure!","That key does not unlock the filing cabinet.");break;case 18:AddMessage("Failure!","That key does not unlock the second locker.")}break;case"006":switch(b){case 0:var d=new Date;AddMessage("Check the time:","The current time is "+d.getHours()+":"+d.getMinutes()+".")}break;case"007":switch(b){case 0:var e=confirm("Are you sure you want to assume this is you?\nThis cannot be reversed.");1==e&&(localStorage.you=JSON.stringify({name:"Toby Smith",image:"img/avatars/avatar0.jpg",age:"19",gender:"Male",height:"190cm",set:!0}),RemoveAction(0,"007"),RemoveAction(0,"008"),RemoveAction(0,"009"),RemoveAction(0,"010"),AddMessage("Assume this is you:","You are now the person in this patient file. You can view your profile <a href='profile.html'>here<a>."))}break;case"008":switch(b){case 0:var e=confirm("Are you sure you want to assume this is you?\nThis cannot be reversed.");1==e&&(localStorage.you=JSON.stringify({name:"Jess Jones",image:"img/avatars/avatar2.jpg",age:"24",gender:"Female",height:"165cm",set:!0}),RemoveAction(0,"007"),RemoveAction(0,"008"),RemoveAction(0,"009"),RemoveAction(0,"010"),AddMessage("Assume this is you:","You are now the person in this patient file. You can view your profile <a href='profile.html'>here<a>."))}break;case"009":switch(b){case 0:var e=confirm("Are you sure you want to assume this is you?\nThis cannot be reversed.");1==e&&(localStorage.you=JSON.stringify({name:"Sam Bill",image:"img/avatars/avatar1.jpg",age:"36",gender:"Male",height:"184cm",set:!0}),RemoveAction(0,"007"),RemoveAction(0,"008"),RemoveAction(0,"009"),RemoveAction(0,"010"),AddMessage("Assume this is you:","You are now the person in this patient file. You can view your profile <a href='profile.html'>here<a>."))}break;case"010":switch(b){case 0:var e=confirm("Are you sure you want to assume this is you?\nThis cannot be reversed.");1==e&&(localStorage.you=JSON.stringify({name:"Harriet Walker",image:"img/avatars/avatar3.jpg",age:"48",gender:"Female",height:"159cm",set:!0}),RemoveAction(0,"007"),RemoveAction(0,"008"),RemoveAction(0,"009"),RemoveAction(0,"010"),AddMessage("Assume this is you:","You are now the person in this patient file. You can view your profile <a href='profile.html'>here<a>."))}break;case"011":switch(b){case 0:AddMessage("Success!","The crowbar forced the door open."),DoorRemoveKey(0,3,"011")}break;case"012":switch(b){case 0:var f=JSON.parse(localStorage.rooms),g=JSON.parse(localStorage.roomNumber);f[g].wallText+=" "+prompt("What do you want to write?",""),localStorage.rooms=JSON.stringify(f)}break;case"013":switch(b){case 0:AddMessage("Failure!","That key does not unlock the door.");break;case 1:AddMessage("Success!","You unlock the filing cabinet."),TaskRemoveKey(7,1,"013"),RemoveAction(16,"003"),RemoveAction(17,"005"),RemoveAction(1,"016");break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:AddMessage("Failure!","That key does not unlock the top draw.");break;case 17:AddMessage("Failure!","That key does not unlock the second locker.")}break;case"014":switch(b){case 0:alert("The code is: 4582")}break;case"015":switch(b){case 0:AddMessage("Lick the 20p coin:","Unfortunately the 20p coin doesn't taste as good as the freddo™ it could have bought a few years ago...")}break;case"016":switch(b){case 0:AddMessage("Success!","You unlock the door."),DoorRemoveKey(7,0,"016"),RemoveAction(15,"003"),RemoveAction(16,"005"),RemoveAction(0,"013");break;case 1:AddMessage("Failure!","That key does not unlock the filing cabinet.");break;case 2:AddMessage("Success!","You unlock the second locker."),TaskRemoveKey(8,3,"016"),RemoveAction(17,"003"),RemoveAction(18,"005"),RemoveAction(17,"013");break;case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:AddMessage("Failure!","That key does not unlock the top draw.")}break;case"017":switch(b){case 0:var c=JSON.parse(localStorage.inventory);AddItem(c[0].wearing);var c=JSON.parse(localStorage.inventory);c[0].wearing="017",localStorage.inventory=JSON.stringify(c),RemoveItem("017")}break;case"018":switch(b){case 0:AddMessage("Drink the can of Coke:","Dispite being warm the Coke was still refreshing."),RemoveItem("018")}break;case"020":switch(b){case 0:AddMessage("Success!","The lock breaks off and the door swings open. Now that you can get close you see there is a ladder doing both up and down the lift shaft."),TaskRemoveKey(9,1,"020"),RemoveAction(0,"020")}break;case"022":switch(b){case 0:for(var c=JSON.parse(localStorage.inventory),h=0;h<c.length;h++)if("022"==c[h].snowflake){if(c[h].bandages>0){AddItem("025");var c=JSON.parse(localStorage.inventory);c[h].bandages--,localStorage.inventory=JSON.stringify(c)}var c=JSON.parse(localStorage.inventory);0==c[h].bandages&&RemoveItem("022")}}break;case"024":switch(b){case 0:var c=JSON.parse(localStorage.inventory);AddItem(c[0].wearing);var c=JSON.parse(localStorage.inventory);c[0].wearing="024",localStorage.inventory=JSON.stringify(c),RemoveItem("024")}break;case"025":switch(b){case 0:RemoveItem("025");for(var c=JSON.parse(localStorage.inventory),h=0;h<c.length;h++)"028"==c[h].snowflake&&(c[h].bandages++,localStorage.inventory=JSON.stringify(c),6==c[h].bandages&&1==c[h].spirit&&(RemoveItem("028"),AddItem("029")))}break;case"026":switch(b){case 0:RemoveItem("026");for(var c=JSON.parse(localStorage.inventory),h=0;h<c.length;h++)"028"==c[h].snowflake&&(c[h].spirit++,localStorage.inventory=JSON.stringify(c),6==c[h].bandages&&1==c[h].spirit&&(RemoveItem("028"),AddItem("029")))}break;case"027":switch(b){case 0:RemoveItem("029");var f=JSON.parse(localStorage.rooms);f[22].description="This is a reception area for the ground floor of the hospital, it also looks like the main entrance. There isn't much in the room apart from a few chairs and a desk. At one end of the room, where other floors only had windows, there are some double electric doors leading outside. The ambulance that was blocking the doors has now  moved far enough away from the doors for you to leave!",localStorage.rooms=JSON.stringify(f),DoorRemoveKey(22,3,"000")}}SelectRoom(JSON.parse(localStorage.roomNumber))}function RemoveAction(a,b){for(var c=JSON.parse(localStorage.inventory),d=JSON.parse(localStorage.items),e=0;e<c.length;e++)c[e].snowflake==b&&c[e].actions.splice(a,1);for(var e=0;e<d.length;e++)d[e].snowflake==b&&d[e].actions.splice(a,1);localStorage.inventory=JSON.stringify(c),localStorage.items=JSON.stringify(d)}function ArrayContains(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1}
